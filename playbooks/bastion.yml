- name: Configure bastion virtual machine
  hosts: bastion
  vars:
    bastion_user: bastion
  tasks:
    - name: Ensure /etc/hosts is configured
      ansible.builtin.import_role:
        name: dynamic_hosts

    - name: Deploy code_server
      ansible.builtin.import_role:
        name: code_server
      vars:
        code_server_user: "{{ bastion_user }}"
        code_server_container: code-server
        code_server_image: code-server-bastion
        code_server_sudo_pass: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          34633465323133663336383031356331373066303537366233323033366562656263623137613532
          3031346534366231386461333834653330623962646262370a343265333163363236666636663134
          37376637613962626263326430313733346536303730383032366263653765633836383334303131
          3439306135316638320a336335303631633065373636616531633865323131313738633366633664
          3434
        code_server_proxy_domain: '{{ bastion_code_host }}'
        code_server_workspace: code_server_workspace
        code_server_extra_pkgs:
          - git
          - curl
          - wget
          - ansible
          - ansible-lint
          - vim
          - nano
