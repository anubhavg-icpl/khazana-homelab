- name: Create Caddy Quadlet file
  become: true
  become_user: "{{ reverse_proxy_user }}"
  notify: Restart Caddy
  containers.podman.podman_container:
    name: "{{ reverse_proxy_container }}"
    image: docker.io/caddy:latest
    state: quadlet
    quadlet_filename: "{{ reverse_proxy_container }}"
    ports:
      - "443:443"
      - "443:443/udp"
      - "80:80"
    volumes:
      - "{{ reverse_proxy_opt }}:/config:z"
      - "{{ reverse_proxy_tls }}:/data:z"
      - "{{ reverse_proxy_conf }}:/etc/caddy/Caddyfile:z"
    env:
      PUID: "1000"
      PGID: "1000"
      TZ: "{{ tz }}"
    quadlet_options:
      - "AutoUpdate=registry"
      - "Pull=newer"
      - |
        [Install]
        WantedBy=default.target multi-user.target
