---
- name: Create Postgres Quadlet file
  become: true
  become_user: "{{ postgres_podman_user }}"
  notify: Restart Postgres
  containers.podman.podman_container:
    name: "{{ postgres_container }}"
    image: docker.io/postgres:latest
    userns: "{{ 'keep-id' if postgres_data_dir is defined else '' }}"
    network: "{{ postgres_network }}"
    state: quadlet
    quadlet_filename: "{{ postgres_container }}"
    ports:
      - "5432:5432"
    volumes:
      - "{{ (postgres_data_dir is defined | ternary(postgres_data_dir, postgres_data_vol)) }}:/var/lib/postgresql/data:z"
    env:
      PUID: "1000"
      PGID: "1000"
      TZ: "{{ tz }}"
      POSTGRES_DB: "{{ postgres_db }}"
      POSTGRES_USER: "{{ postgres_user }}"
      POSTGRES_PASSWORD: "{{ postgres_pass }}"
    quadlet_options:
      - "AutoUpdate=registry"
      - "Pull=newer"
      - |
        [Install]
        WantedBy=default.target multi-user.target
