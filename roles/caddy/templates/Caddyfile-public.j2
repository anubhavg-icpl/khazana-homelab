# DO NOT MODIFY MANUALLY, GENERATED WITH ANSIBLE
# Global config
{
  servers {
    trusted_proxies static private_ranges
  }

   tailscale {

    public-reverse-proxy {

      # Alternate control server URL.
      control_url https://{{ vpn_host }}{{ internet_host }}

      # If true, remove this node after disconnect.
      ephemeral false

      # Hostname to request when registering this node.
      # Default: <node_name> used for this node configuration
      hostname public-reverse-proxy

      # Directory to store Tailscale state in for this node. No subdirectory is created.
      state_dir /config/tailscale

      # If true, run the Tailscale web UI for remotely managing this node.
      webui false
    }

   }
}

# Snippets

# Proxy with compression. Uses plain HTTP
(proxy) {
  encode {
    zstd better
    gzip 6
  }
  reverse_proxy {args[0]}
}

# Proxy with compression. Uses https and ignores tls stuff
(proxy_tls) {
  encode {
    zstd better
    gzip 6
  }
  reverse_proxy {args[0]} {
    transport http {
      tls
      tls_insecure_skip_verify
    }
  }
}

# VPN Service

{{ vpn_host }}.{{ internet_host }} {
  import proxy headscale:8080
}

{{ music_host }}.{{ internet_host }} {
  import proxy tailscale_client_public_reverse_proxy
}
