- name: Configure streaming virtual machine
  hosts: streaming
  vars:
    streaming_user: streaming
    streaming_music: /music
  tasks:
    - name: Deploy Navidrome
      ansible.builtin.import_role:
        name: navidrome
      vars:
        navidrome_user: "{{ streaming_user }}"
        navidrome_container: navidrome
        navidrome_config: 'navidrome_config'
        navidrome_collection: "{{ streaming_music }}"
        navidrome_lastfm_apikey: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          38653636616230343838626333353737383531333562663162646332323565613761346233346564
          3662353635636563306537613133306632383561643234320a373135313966346163323862633031
          30383535396238623231313135663662376462346664346664653439386331356261363861356635
          3731303534613539370a366262636262373730613862303863346636343538306165373139356330
          35653637333265353433316139353562323838616632633733363837646631643734393237373463
          3238636232356565623365303232613332626162663038626334
        navidrome_lastfm_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37326432623665613430626132396561383964636330316538623835633363636632383964663532
          6638653035306337353765383962333932323038343333620a323263303566393866316465353664
          36376138353064656536306162643839326535343633623461316636343333333837613561333163
          3537313339383265630a346437383561353136666562343665373132663362643931323061373839
          30373138663138386663336537363433396464626564336566663763636634663735646533343933
          6561336366386535353135633839376462326437323436326537

    - name: Deploy Wazuh agent
      ansible.builtin.import_role:
        name: wazuh_agent
      vars:
        wazuh_agent_version: '4.x'
        wazuh_agent_manager_host: '{{ siem_host }}'
        wazuh_agent_registration_pass: '{{ siem_enrollment_pass }}'
        wazuh_agent_name: 'streaming'
        wazuh_agent_groups: 'internet_facing,trusted'
